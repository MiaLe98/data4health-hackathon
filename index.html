<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="life.css" />

  <title>Cell Simulator</title>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col">
        <!-- <div class="input">
          <label for="units_number">Please type in the number of units</label>
          <input id="units_number" type="number" min="1" />
          <span id="error_unit_number" style="display: none"
            >Please choose a number in range from 2 to 5</span
          >
        </div> -->
        <div class="control-wrapper label-button-groups">
          <p style="font-size: x-large">Choose Culture Media</p>
          <button type="button" class="btn btn-secondary" id="RPMI-1640">
            RPMI-1640
          </button>
          <button type="button" class="btn btn-secondary" id="X-VIVO1S">
            X-VIVO1S
          </button>
          <button type="button" class="btn btn-secondary" id="SCGM">
            SCGM
          </button>
        </div>
        <div class="control-wrapper environment-button-groups">
          <p style="font-size: x-large">Environment Control</p>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="CO2">
              CO2
            </button>
            <input
              type="number"
              class="form-control"
              id="CO2-input"
              placeholder="Enter concentrations"
            />
          </div>

          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="O2">O2</button>
            <input
              type="number"
              class="form-control"
              id="O2-input"
              placeholder="Enter concentrations"
            />
          </div>

          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="pH">pH</button>
            <input
              type="number"
              class="form-control"
              id="pH-input"
              placeholder="Enter concentrations"
            />
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="temp">
              Temperature
            </button>
            <input
              type="number"
              class="form-control"
              id="temp-input"
              placeholder="Enter temperature"
            />
          </div>
        </div>
        <div class="control-wrapper add-cell-button-groups">
          <p style="font-size: x-large">Add Cell Types</p>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="B-Cell">
              B-Cell
            </button>
            <input
              type="number"
              class="form-control"
              id="B-Cell-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="B-Cell-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="T-Cell">
              T-Cell
            </button>
            <input
              type="number"
              class="form-control"
              id="T-Cell-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="T-Cell-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="NK-Cell">
              NK-Cell
            </button>
            <input
              type="number"
              class="form-control"
              id="NK-Cell-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="NK-Cell-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="Tumor">
              Tumor
            </button>
            <input
              type="number"
              class="form-control"
              id="Tumor-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="Tumor-delete"> ❌ </span>
          </div>
        </div>
        <div class="control-wrapper add-cell-button-groups">
          <p style="font-size: x-large">Add Cytokines</p>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IL-2">
              IL-2
            </button>
            <input
              type="number"
              class="form-control"
              id="IL-2-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IL-2-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IFNg">
              IFNg
            </button>
            <input
              type="number"
              class="form-control"
              id="IFNg-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IFNg-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IFNa">
              IFNa
            </button>
            <input
              type="number"
              class="form-control"
              id="IFNa-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IFNa-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IL-4">
              IL-4
            </button>
            <input
              type="number"
              class="form-control"
              id="IL-4-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IL-4-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IL-6">
              IL-6
            </button>
            <input
              type="number"
              class="form-control"
              id="IL-6-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IL-6-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IL-8">
              IL-8
            </button>
            <input
              type="number"
              class="form-control"
              id="IL-8-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IL-8-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IL-10">
              IL-10
            </button>
            <input
              type="number"
              class="form-control"
              id="IL-10-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IL-10-delete"> ❌ </span>
          </div>
          <div class="control-field">
            <button type="button" class="btn btn-secondary" id="IL-12">
              IL-12
            </button>
            <input
              type="number"
              class="form-control"
              id="IL-12-input"
              placeholder="Enter intial concentrations"
            />
            <span>µg/ml</span>
            <span class="delete-btn" id="IL-12-delete"> ❌ </span>
          </div>
        </div>
      </div>
      <div
        class="col"
        style="
          display: flex;
          align-items: center;
          justify-content: center;
          flex-wrap: wrap;
        "
      >
        <div
          style="
            border-radius: 50%;
            border: 1px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 512px;
            height: 512px;
          "
        >
          <div id="gridContainer"></div>
        </div>
        <div style="font-size: large; position: absolute; top: 680px">
          <div style="text-align: center">
            <span id="label"></span>
          </div>
          <div style="display: flex">
            <span
              class="environment-label"
              style="font-size: small"
              id="CO2-label"
            ></span>
            <span
              class="environment-label"
              style="font-size: small"
              id="O2-label"
            ></span>
            <span
              class="environment-label"
              style="font-size: small"
              id="pH-label"
            ></span>
            <span
              class="environment-label"
              style="font-size: small"
              id="temp-label"
            ></span>
          </div>
        </div>
      </div>
    </div>
    <hr>
    <h1 align="center"><u>The current selection of Ingredients would result in:</u></h1>
    <div class="row" align="center">
      <div class="col-3">
        <h2>Predicted Culture<br>Efficiency</h2>
        <h1 ><span class="pred-efficiency">86</span>%</h1>
      </div>
      <div class="col-3">
        <h2>Predicted Growth<br>Rate</h2>
        <h1><span class="pred-growth">320</span>%
        <br><small>per day</small></h1>
      </div>
      <div class="col-3">
        <h2>Estimated<br>Dosage Volume</h2>
        <h1 ><span class="pred-volume">50</span>ml</h1>
      </div>
      <div class="col-3">
        <h2>Simulator<br>Accuracy</h2>
        <h1 ><span class="pred-acc">82</span>%</h1>
      </div>
    </div>
  </div>

  <div class="output">
    <p id="display_cell_name" contenteditable="true" style="display: none">
      Cell Name
    </p>
  </div>

  <script
    src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"
  ></script>

  <script>
      function randomIntFromInterval(min, max) { // min and max included
          return Math.floor(Math.random() * (max - min + 1) + min)
      }
    function setPredictionUi(efficiency, growth, volume, accuracy){
        $(".pred-efficiency").html(efficiency);
        $(".pred-growth").html(growth);
        $(".pred-volume").html(volume);
        $(".pred-acc").html(accuracy);
    }

      $("input.form-control").change(function(){
          sendPredictionRequest();
      })
    function sendPredictionRequest(){
          console.log("sendPredictionRequest()")
        var payload = {};
        $("input.form-control").each(function(x, elem){
            var el = $(elem);
            var value = el.val();
            var id = el.attr("id");

            payload[id] = (value.length == 0 ? 0 : parseInt(value));
        });
        console.log("payload::", payload);

        // $.post("/mlsim",function(data){
        //     data = JSON.parse(data);
              var input = payload;
              var mock_ml_equation_result = {
                  acc: randomIntFromInterval(79,86),
                  efficiency: (input['B-Cell-input'] / (input['B-Cell-input'] * input['NK-Cell-input']))
                  * ((input['IL-2-input'] + input['IL-4-input'] + input['IL-8-input']) / (input['IL-10-input'] + input['IL-12-input'] + input['IL-6-input'])),
                  growth: randomIntFromInterval(130,392),
                  volume: randomIntFromInterval(5,100)
              }

              if(mock_ml_equation_result.efficiency == 0 || !mock_ml_equation_result.efficiency || mock_ml_equation_result.efficiency == "Infinity"){
                  mock_ml_equation_result.efficiency = randomIntFromInterval(51,92);
              }else{
                  mock_ml_equation_result.efficiency *= 100;
                  mock_ml_equation_result.efficiency = mock_ml_equation_result.efficiency.toFixed(2);
              }

              console.log("mock_ml_equation_result::", mock_ml_equation_result);

              setPredictionUi(
                      mock_ml_equation_result.acc,
                      mock_ml_equation_result.efficiency,
                      mock_ml_equation_result.growth,
                      mock_ml_equation_result.volume);

        // });
    }

    sendPredictionRequest();
  </script>

  <script src="newLife.js"></script>
</body>
